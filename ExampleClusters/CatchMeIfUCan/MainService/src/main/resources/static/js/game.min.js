let cmiuc={};!function(e){"use strict";e.config={canvasLayout:[["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"],["1","0","0","0","0","1","0","0","1","0","0","1","0","0","1","0","0","0","0","1","0","1","0","0","1"],["1","0","1","1","1","1","0","0","1","0","0","1","1","1","1","0","0","0","0","1","0","1","1","1","1"],["1","0","1","0","0","1","0","0","1","0","0","1","0","0","1","0","0","0","0","1","0","0","0","0","1"],["1","0","1","0","0","1","1","1","1","0","0","1","0","0","1","1","1","1","1","1","1","1","1","1","1"],["1","1","1","0","0","1","0","0","1","0","0","1","1","0","0","0","1","0","0","1","0","0","0","0","1"],["1","0","1","0","0","1","0","0","1","0","0","0","1","0","0","0","1","1","0","1","0","1","1","1","1"],["1","0","1","0","0","1","0","0","1","1","0","0","1","0","0","0","0","1","0","1","0","1","0","0","0"],["1","0","1","1","0","1","0","0","0","1","0","0","1","0","0","0","0","1","0","1","1","1","0","0","0"],["1","0","0","1","1","1","0","0","0","1","1","1","1","1","1","1","1","1","0","1","0","1","0","0","0"],["1","0","0","0","0","1","0","0","0","1","0","0","1","0","0","1","0","0","0","1","0","1","1","1","1"],["1","1","1","0","0","1","0","0","0","1","0","0","1","0","0","1","0","0","0","1","0","0","0","0","1"],["1","0","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","0","1"],["1","0","0","1","0","1","0","0","0","1","0","0","1","0","0","1","0","0","0","0","0","0","1","1","1"],["1","0","0","1","0","1","0","0","0","1","0","0","1","0","0","1","0","0","0","0","0","0","0","0","1"],["1","1","1","1","0","1","1","0","0","1","1","1","1","1","1","1","1","1","1","1","1","1","1","0","1"],["1","0","0","0","0","0","1","0","0","0","0","0","1","0","0","0","0","0","1","0","0","0","1","0","1"],["1","1","1","0","0","0","1","0","0","0","0","0","1","0","0","0","0","0","1","0","0","0","1","0","1"],["0","0","1","0","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","0","1","0","1"],["1","1","1","0","1","0","1","0","0","1","0","0","1","0","0","0","1","0","0","0","1","0","1","0","1"],["1","0","1","0","1","0","1","1","1","1","0","0","1","0","0","0","1","0","0","0","1","0","1","1","1"],["1","0","1","0","1","0","1","0","0","1","0","0","1","1","1","1","1","1","1","0","1","0","0","0","1"],["1","0","1","1","1","0","1","0","0","1","0","0","1","0","0","0","0","0","1","0","1","1","1","0","1"],["1","0","0","0","0","0","1","0","0","1","0","0","1","0","1","1","1","0","1","0","1","0","1","0","1"],["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","0","1","1","1","1","1","0","1","1","1"]],canvasWidth:500,canvasHeight:500,canvasDivX:25,canvasDivY:25,canvasRestrictedColour:"silver",gamePieceColour:"red",gamePieceRadius:9,gamePieceStartPosition:[250,250],gamePieceStep:5,gamePieceStepInterval:75,gamePieceSquareBuffer:1.001,opponentPieceColour:"black",opponentPieceRadius:9,opponentPieceStart:[[10,10],[10,490],[490,10],[490,490]],opponentPieceStep:5,opponentPieceStepInterval:75,randomMoveProbability:10,catchCheckInterval:10,scoreChangeInterval:250,levelChangeScore:25,levelUpSpeedChangeRate:5,highValue:1e4},e.util={},e.gamePiece=null,e.opponentPiece=[],e.score=0,e.level=0,e.playStarted=!1,e.timer=[],e.gamePieceTimer=null,e.opponentTimer=null,e.Piece=function(e,t,i,n){return this.x=e,this.y=t,this.radius=i,this.colour=n,this},e.Piece.prototype.currentDirection=null,e.Piece.prototype.futureDirection=null,e.Piece.prototype.erase=function(){let t=this.x,i=this.y,n=this.radius+e.config.gamePieceSquareBuffer,o=2*n;e.canvas.getContext("2d").clearRect(t-n,i-n,o,o)},e.Piece.prototype.getRandomDirection=function(){let e=["right","down","left","up"];return e[Math.floor(Math.random()*e.length)]},e.Piece.prototype.getPossibleRandomDirection=function(){let e=this,t=null;do{t=e.futureDirection=this.getRandomDirection()}while(!e.isFutureDirectionPossible());return t},e.Piece.prototype.movePieceTo=function(t,i){let n=e.canvas.getContext("2d");n.beginPath(),n.arc(t,i,this.radius,0,2*Math.PI),n.fillStyle=this.colour,n.fill(),n.stroke(),this.x=t,this.y=i,this.ctx=n},e.Piece.prototype.takeOneStep=function(t){if("left"!==t&&"right"!==t&&"up"!==t&&"down"!==t)return!1;let i=this.x,n=this.y,o=e.config.gamePieceStep,r=this.radius;switch(t){case"left":i-=o;break;case"up":n-=o;break;case"right":i+=o;break;case"down":n+=o}let c=[i+r,n-r],a=[i-r,n+r];return!e.util.isInsideRestrictedArea(c)&&!e.util.isInsideRestrictedArea(a)&&(this.erase(),this.movePieceTo(i,n),!0)},e.Piece.prototype.isSetForReverse=function(){switch(this.currentDirection){case"left":return"right"===this.futureDirection;case"right":return"left"===this.futureDirection;case"up":return"down"===this.futureDirection;case"down":return"up"===this.futureDirection}return!1},e.Piece.prototype.reverseDirection=function(){"left"===this.currentDirection?this.currentDirection=this.futureDirection="right":"right"===this.currentDirection?this.currentDirection=this.futureDirection="left":"up"===this.currentDirection?this.currentDirection=this.futureDirection="down":"down"===this.currentDirection&&(this.currentDirection=this.futureDirection="up")},e.Piece.prototype.isXYInBentCell=function(t){let i=e.util.getIJFromXY(t),n=i[0],o=i[1],r=e.config.canvasLayout,c=r.length-1;return 0===n||n===c?"1"===r[n][o-1]&&(o===c||"0"===r[n][o+1])||(0===o||"0"===r[n][o-1])&&"1"===r[n][o+1]:0===o||o===c?"1"===r[n-1][o]&&(n===c||"0"===r[n+1][o])||(0===n||"0"===r[n-1][o])&&"1"===r[n+1][o]:"1"!==r[n-1][o]&&"1"!==r[n+1][o]||r[n-1][o]===r[n+1][o]?("1"===r[n][o-1]||"1"===r[n][o+1])&&r[n][o-1]!==r[n][o+1]&&(0!==n&&"1"===r[n-1][o]&&n!==c&&"0"===r[n+1][o]||0!==n&&"0"===r[n-1][o]&&n!==c&&"1"===r[n+1][o]):0!==o&&"1"===r[n][o-1]&&o!==c&&"0"===r[n][o+1]||0!==o&&"0"===r[n][o-1]&&o!==c&&"1"===r[n][o+1]},e.Piece.prototype.isExactlyInBentCell=function(){let e=this.x,t=this.y,i=this.radius,n=[e,t],o=[e+i,t-i],r=[e-i,t+i];return this.isXYInBentCell(n)&&this.isXYInBentCell(o)&&this.isXYInBentCell(r)},e.Piece.prototype.checkForCellEquality=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e.Piece.prototype.isExactlyInTerminalCell=function(){let t=this.x,i=this.y,n=this.radius,o=[t,i],r=[t+n,i-n],c=[t-n,i+n];return!!this.checkForCellEquality(e.util.getIJFromXY(c),e.util.getIJFromXY(r))&&(e.util.isXYInTerminalCell(o)&&e.util.isXYInTerminalCell(r)&&e.util.isXYInTerminalCell(c))},e.Piece.prototype.isExactlyInJunctionCell=function(){let t=this.x,i=this.y,n=this.radius,o=[t,i],r=[t+n,i-n],c=[t-n,i+n];return!!this.checkForCellEquality(e.util.getIJFromXY(c),e.util.getIJFromXY(r))&&(e.util.isXYInJunctionCell(o)&&e.util.isXYInJunctionCell(r)&&e.util.isXYInJunctionCell(c))},e.Piece.prototype.isCurrentDirectionPossible=function(){let t=this.x,i=this.y,n=e.config.gamePieceStep,o=this.radius;switch(this.currentDirection){case"left":t-=n;break;case"up":i-=n;break;case"right":t+=n;break;case"down":i+=n}let r=[t+o,i-o],c=[t-o,i+o];return!(e.util.isInsideRestrictedArea(r)||e.util.isInsideRestrictedArea(c))},e.Piece.prototype.isFutureDirectionPossible=function(){let t=this.x,i=this.y,n=e.config.gamePieceStep,o=this.radius;switch(this.futureDirection){case"left":t-=n;break;case"up":i-=n;break;case"right":t+=n;break;case"down":i+=n}let r=[t+o,i-o],c=[t-o,i+o];return!(e.util.isInsideRestrictedArea(r)||e.util.isInsideRestrictedArea(c))},e.Piece.prototype.getObviousDirection=function(){let t=e.util.getIJFromPiece(this),i=t[0],n=t[1],o=e.config.canvasLayout,r=o.length-1,c=o[0].length-1,a=this.currentDirection,s=null;return"left"===a?s=0!==i&&"1"!==o[i-1][n]||i!==r&&"0"!==o[i+1][n]?i!==r&&"1"!==o[i+1][n]||0!==i&&"0"!==o[i-1][n]?"right":"down":"up":"right"===a?s=0!==i&&"1"!==o[i-1][n]||i!==r&&"0"!==o[i+1][n]?i!==r&&"1"!==o[i+1][n]||0!==i&&"0"!==o[i-1][n]?"left":"down":"up":"up"===a?s=0!==n&&"1"!==o[i][n-1]||n!==c&&"0"!==o[i][n+1]?n!==c&&"1"!==o[i][n+1]||0!==n&&"0"!==o[i][n-1]?"down":"right":"left":"down"===a&&(s=0!==n&&"1"!==o[i][n-1]||n!==c&&"0"!==o[i][n+1]?n!==c&&"1"!==o[i][n+1]||0!==n&&"0"!==o[i][n-1]?"up":"right":"left"),s},e.Piece.prototype.setMovementDirection=function(t){this.futureDirection=t,window.clearInterval(e.gamePieceTimer),e.gamePieceTimer=window.setInterval(()=>{this.move()},e.config.gamePieceStepInterval-(e.level-1)*e.config.levelUpSpeedChangeRate),e.playStarted||e.startPlay()},e.opponentPiece.updatePathArray=function(t,i,n,o){let r=t[0],c=t[1],a=e.config.canvasLayout,s=e.config.canvasDivX-1,l=e.config.canvasDivY-1,u=e.util.getIJFromPiece(this),h=u[0],g=u[1],f=!1;if(r===h&&c===g&&this.minDistanceToGamePiece>n)this.minDistanceToGamePiece=n;else if(!(n>i[r][c]||e.util.isOpponentPresentInIJ(t))){if(e.util.isXYInJunctionCell([this.x,this.y]))n++;else{do{switch(o){case"up":r++;break;case"down":r--;break;case"left":c++;break;case"right":c--}(f=r>=0&&r<=l&&c>=0&&c<=s)&&(i[r][c]=++n)}while(f&&!e.util.isXYInJunctionCell(e.util.getXYFromIJ([r,c]))&&(r!==h||c!==g));if(r===h&&c===g)return void(this.minDistanceToGamePiece=this.minDistanceToGamePiece>n?n:this.minDistanceToGamePiece);r=-1===r?0:r===l+1?l:r,c=-1===c?0:c===s+1?s:c}if("up"!==o&&r>0&&"1"===a[r-1][c]){if(i[r-1][c]<n||r-1===h&&c===g)return;i[r-1][c]=n<i[r-1][c]?n:i[r-1][c],this.updatePathArray([r-1,c],i,n,"down")}if("down"!==o&&r<l&&"1"===a[r+1][c]){if(i[r+1][c]<n||r+1===h&&c===g)return;i[r+1][c]=n<i[r+1][c]?n:i[r+1][c],this.updatePathArray([r+1,c],i,n,"up")}if("left"!==o&&c>0&&"1"===a[r][c-1]){if(i[r][c-1]<n||r===h&&c-1===g)return;i[r][c-1]=n<i[r][c-1]?n:i[r][c-1],this.updatePathArray([r,c-1],i,n,"right")}if("right"!==o&&c<s&&"1"===a[r][c+1]){if(i[r][c+1]<n||r===h&&c+1===g)return;i[r][c+1]=n<i[r][c+1]?n:i[r][c+1],this.updatePathArray([r,c+1],i,n,"left")}this.minDistanceToGamePiece=e.config.highValue}},e.opponentPiece.getBestDirectionFromPathArray=function(t){let i=e.util.getIJFromPiece(this),n=e.config.canvasDivX-1,o=e.config.canvasDivY-1,r=i[0],c=i[1],a=e.config.highValue,s=null;return 0!==r&&a>t[r-1][c]&&(s="up",a=t[r-1][c]),r!==o&&a>t[r+1][c]&&(s="down",a=t[r+1][c]),0!==c&&a>t[r][c-1]&&(s="left",a=t[r][c-1]),c!==n&&a>t[r][c+1]&&(s="right"),s},e.opponentPiece.computeBestDirection=function(){let t=e.gamePiece;if(Math.floor(100*Math.random())<e.config.randomMoveProbability)return this.getPossibleRandomDirection();let i=e.util.initialisePathArray();return this.updatePathArray(e.util.getIJFromPiece(t),i,0),this.getBestDirectionFromPathArray(i)},e.bindOpponentPieceFunctions=function(t){t.move=e.opponentPiece.move,t.computeBestDirection=e.opponentPiece.computeBestDirection,t.getBestDirectionFromPathArray=e.opponentPiece.getBestDirectionFromPathArray,t.updatePathArray=e.opponentPiece.updatePathArray},e.createOpponentPiece=((t,i)=>{let n=e.canvas.getContext("2d");n.beginPath(),n.arc(t,i,e.config.opponentPieceRadius,0,2*Math.PI),n.fillStyle=e.config.opponentPieceColour,n.fill(),n.stroke();let o=new e.Piece(t,i,e.config.opponentPieceRadius,e.config.opponentPieceColour);return o.ctx=n,o.minDistanceToGamePiece=e.config.highValue,e.bindOpponentPieceFunctions(o),o}),e.addOpponent=function(t,i){let n=e.createOpponentPiece(t,i),o=n.ctx;o.fill(),o.stroke(),e.opponentPiece.push(n)},e.util.createRestrictedZone=function(t,i,n,o){let r=e.gamePiece.ctx;r.beginPath(),r.fillStyle=e.config.canvasRestrictedColour,r.fillRect(t*n,i*o,n,o),r.fill(),r.closePath()},e.util.isInsideCanvasArea=function(t,i){return(null===t||!(t<0||t>e.config.canvasWidth))&&!(null!==i&&(i<0||i>e.config.canvasHeight))},e.util.isInsideRestrictedArea=function(t){let i=t[0],n=t[1],o=Math.floor(n/(e.config.canvasHeight/e.config.canvasDivY)),r=Math.floor(i/(e.config.canvasWidth/e.config.canvasDivX)),c=e.config.canvasLayout;return!e.util.isInsideCanvasArea(i,n)||(o<0||r<0||"0"===c[o][r])},e.util.getIJFromPiece=function(t){let i=t.x,n=t.y,o=e.config.canvasWidth/e.config.canvasDivX,r=e.config.canvasHeight/e.config.canvasDivY,c=Math.floor(i/o);return[Math.floor(n/r),c]},e.util.getIJFromXY=function(t){let i=t[0],n=t[1],o=e.config.canvasWidth/e.config.canvasDivX,r=e.config.canvasHeight/e.config.canvasDivY,c=Math.floor(i/o);return[Math.floor(n/r),c]},e.util.getXYFromIJ=function(t){let i=t[0],n=t[1],o=e.config.canvasWidth/e.config.canvasDivX,r=e.config.canvasHeight/e.config.canvasDivY;return[Math.floor(n*o)+o/2,Math.floor(i*r)+r/2]},e.util.isOpponentPresentInIJ=function(t){let i=t[0],n=t[1];for(let t=e.config.opponentPieceStart.length-1;t>=0;t--){let o=e.opponentPiece[t],r=e.util.getIJFromPiece(o);if(i===r[0]&&n===r[1])return!0}return!1},e.util.getReverseDirection=function(e){return"left"===e?"right":"right"===e?"left":"down"===e?"up":"up"===e?"down":null},e.util.initialisePathArray=function(){let t=[],i=e.config.highValue;for(let n=e.config.canvasDivY-1;n>=0;n--){let o=[];for(let t=e.config.canvasDivX-1;t>=0;t--)o.push(i);t[n]=o}return t},e.util.isXYInTerminalCell=function(t){let i=e.util.getIJFromXY(t),n=i[0],o=i[1],r=e.config.canvasLayout,c=e.config.canvasDivX-1,a=e.config.canvasDivY-1;return!(0!==n&&"1"!==r[n-1][o]||n!==a&&"0"!==r[n+1][o]||0!==o&&"0"!==r[n][o-1]||o!==c&&"0"!==r[n][o+1])||(!(n!==a&&"1"!==r[n+1][o]||0!==n&&"0"!==r[n-1][o]||0!==o&&"0"!==r[n][o-1]||o!==c&&"0"!==r[n][o+1])||(!(0!==o&&"1"!==r[n][o-1]||o!==c&&"0"!==r[n][o+1]||0!==n&&"0"!==r[n-1][o]||n!==a&&"0"!==r[n+1][o])||!(o!==c&&"1"!==r[n][o+1]||0!==o&&"0"!==r[n][o-1]||0!==n&&"0"!==r[n-1][o]||n!==a&&"0"!==r[n+1][o])))},e.util.isXYInJunctionCell=function(t){let i=e.util.getIJFromXY(t),n=i[0],o=i[1],r=e.config.canvasLayout;return(n>0&&"1"===r[n-1][o]||n<e.config.canvasDivY-1&&"1"===r[n+1][o])&&(o>0&&"1"===r[n][o-1]||o<e.config.canvasDivX-1&&"1"===r[n][o+1])||(o>0&&"1"===r[n][o-1]||o<e.config.canvasDivX-1&&"1"===r[n][o+1])&&(n>0&&"1"===r[n-1][o]||n<e.config.canvasDivY-1&&"1"===r[n+1][o])},e.util.levelUp=function(){window.clearInterval(e.gamePieceTimer),window.clearInterval(e.opponentTimer),e.timer.push(e.gamePieceTimer=setInterval(()=>{e.gamePiece.move()},e.config.gamePieceStepInterval-(e.level-1)*e.config.levelUpSpeedChangeRate)),e.timer.push(e.opponentTimer=setInterval(()=>{e.moveOpponents()},e.config.opponentPieceStepInterval-(e.level-1)*e.config.levelUpSpeedChangeRate))},e.util.checkForCatch=function(){for(let t=e.config.opponentPieceStart.length-1;t>=0;t--){let i=e.gamePiece.x,n=e.gamePiece.y,o=e.opponentPiece[t],r=i-o.x,c=n-o.y,a=2*(e.config.gamePieceRadius-2*e.config.gamePieceSquareBuffer);Math.abs(r)<a&&Math.abs(c)<a&&e.endPlay()}},e.startScoring=function(){return document.getElementById("levelBoard").innerHTML=`${++e.level}`,e.timer.push(setInterval(()=>{document.getElementById("scoreBoard").innerHTML=`${e.score++}`,document.getElementById("headingText").innerHTML="",e.checkForLevelUp()},e.config.scoreChangeInterval)),!0},e.checkForLevelUp=function(){e.score%e.config.levelChangeScore==0&&(document.getElementById("levelBoard").innerHTML=`${++e.level}`,e.util.levelUp(e.level))},e.moveOpponents=function(){for(let t=e.config.opponentPieceStart.length-1;t>=0;t--){e.opponentPiece[t].move()}},e.startPlay=function(){e.startScoring(),e.playStarted=!0,e.util.levelUp(),e.timer.push(setInterval(()=>{e.util.checkForCatch()},e.config.catchCheckInterval))},e.endPlay=function(){e.util.unBindKeys(),clearInterval(e.gamePieceTimer);for(let t=e.timer.length-1;t>=0;t--)clearInterval(e.timer[t]);document.getElementById("headingText").innerHTML="Game Over!"},e.util.navigationKeyConfig=function(t){switch(t.keyCode){case 37:e.gamePiece.setMovementDirection("left");break;case 38:e.gamePiece.setMovementDirection("up");break;case 39:e.gamePiece.setMovementDirection("right");break;case 40:e.gamePiece.setMovementDirection("down");break;default:t.preventDefault()}},e.util.unBindKeys=function(){document.removeEventListener("keydown",e.util.navigationKeyConfig)},e.init=function(t){this.config=t,this.canvas=(()=>{let e=document.getElementById("canvas");return e.width=this.config.canvasWidth,e.height=this.config.canvasHeight,e})(),this.gamePiece=((e,t)=>{let i=this.canvas.getContext("2d");i.beginPath(),i.arc(e,t,this.config.gamePieceRadius,0,2*Math.PI),i.fillStyle=this.config.gamePieceColour,i.fill(),i.stroke();let n=new this.Piece(e,t,this.config.gamePieceRadius,this.config.gamePieceColour);return n.ctx=i,n})(e.config.gamePieceStartPosition[0],e.config.gamePieceStartPosition[1]),e.gamePiece.move=function(){let e,t=null;!(e=this.isExactlyInJunctionCell())&&this.isSetForReverse()?this.reverseDirection():e?this.isFutureDirectionPossible()?this.currentDirection=this.futureDirection:this.isExactlyInBentCell()?null!==(t=this.getObviousDirection())?this.currentDirection=this.futureDirection=t:this.reverseDirection():this.isCurrentDirectionPossible()||this.reverseDirection():this.isExactlyInTerminalCell()&&this.reverseDirection(),null===this.currentDirection&&(this.currentDirection=this.futureDirection),this.takeOneStep(this.currentDirection)},this.opponentPiece.move=function(){let e,t=null;!(e=this.isExactlyInJunctionCell())&&this.isSetForReverse()?this.reverseDirection():e&&(this.futureDirection=this.computeBestDirection(),this.isFutureDirectionPossible()?this.currentDirection=this.futureDirection:null!==(t=this.getObviousDirection())?this.currentDirection=this.futureDirection=t:this.reverseDirection()),null===this.currentDirection&&(null===this.futureDirection?this.currentDirection=this.futureDirection=this.getPossibleRandomDirection():this.currentDirection=this.futureDirection),this.takeOneStep(this.currentDirection)};for(let e=this.config.opponentPieceStart.length-1;e>=0;e--)this.addOpponent(this.config.opponentPieceStart[e][0],this.config.opponentPieceStart[e][1]);this.canvas.drawCanvas=(()=>{let e=this.config.canvasLayout,t=this.config.canvasWidth/this.config.canvasDivX,i=this.config.canvasHeight/this.config.canvasDivY;for(let n=e.length-1;n>=0;n--){for(let o=e[n].length-1;o>=0;o--)"0"===e[n][o]&&this.util.createRestrictedZone(o,n,t,i)}})(),this.canvas.bindKeys=(()=>{document.addEventListener("keydown",this.util.navigationKeyConfig)})()}}(cmiuc);